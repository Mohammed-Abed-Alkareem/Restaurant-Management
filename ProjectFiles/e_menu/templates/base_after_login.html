<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base_after_login.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cart_window.css') }}" />

    {% block custom_css %} {% endblock %}

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}My Flask App{% endblock %}</title>
</head>
<body>
<header>
    <nav>
        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Restaurant Logo" height="90" width="100%" />
        <h1>Restaurant <span class="highlight">Name</span></h1>

        <!-- Code for Cart Window -->
        <div id="cart-button" onclick="toggleCartVisibility()">
            <img src="{{ url_for('static', filename='img/cart_button.png') }}" alt="Cart Button" width="50" height="50" />
        </div>
        <div id="cart-preview" class="cart-preview" style="display: none">
            <div id="cart-items-container" class="cart-items-container">
                <!-- Items will be dynamically added here -->
            </div>
        </div>
        <!-- Code for Cart Window -->
    </nav>
</header>

{% block content %}
<!-- This block will be overridden by child templates -->
{% endblock %}

<footer>
    <div class="footer__top">
        <h1>Restaurant <span class="highlight">Name</span></h1>
    </div>
    <div class="footer__bottom">
        <div class="footer__wrapper">
            <div>
                <h3>Information</h3>
                <ul>
                    <li><a href="#about">About Us</a></li>
                    <li><a href="#">Events</a></li>
                </ul>
            </div>
            <div>
                <h3>Social</h3>
                <ul>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Linkedin</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>

<!-- JavaScript for toggling cart visibility and fetching session data -->
<script>
    // Function to toggle cart visibility
    function toggleCartVisibility() {
        var cartPreview = document.getElementById("cart-preview");
        if (cartPreview.style.display === "block") {
            cartPreview.style.display = "none";
        } else {
            cartPreview.style.display = "block";
            fetchSessionAndUpdateCartPreview(); // Fetch session data and update cart preview when the cart is shown
        }
    }

    // Function to fetch session data and update cart preview
    function fetchSessionAndUpdateCartPreview() {
        fetch('/customer/get_session')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                updateCartPreview(data.items);
            })
            .catch(error => {
                console.error('Error fetching session data:', error);
            });
    }

   // Function to update cart preview with session data
function updateCartPreview(items) {
    const cartItemsContainer = document.getElementById('cart-items-container');
    cartItemsContainer.innerHTML = ''; // Clear existing cart items

    items.forEach(item => {
        const cartItemDiv = document.createElement('div');
        cartItemDiv.classList.add('cart-item');

        const img = document.createElement('img');
        img.src = `{{ url_for('static', filename='img/menuItems/') }}${item.id}.png`;
        img.alt = item.name;
        img.width = 100;
        img.height = 100;

        const itemDetailsDiv = document.createElement('div');
        itemDetailsDiv.classList.add('item-details');

        const itemNameSpan = document.createElement('span');
        itemNameSpan.classList.add('item-name');
        itemNameSpan.textContent = item.name;

        const itemPriceSpan = document.createElement('span');
        itemPriceSpan.classList.add('item-price');
        itemPriceSpan.textContent = `$${item.price.toFixed(2)}`; // Format price as currency

        const itemQuantitySpan = document.createElement('span');
        itemQuantitySpan.classList.add('item-quantity');
        itemQuantitySpan.textContent = `Quantity: ${item.quantity}`;

        itemDetailsDiv.appendChild(itemNameSpan);
        itemDetailsDiv.appendChild(itemPriceSpan);
        itemDetailsDiv.appendChild(itemQuantitySpan); // Append quantity to item details

        cartItemDiv.appendChild(img);
        cartItemDiv.appendChild(itemDetailsDiv);

        cartItemsContainer.appendChild(cartItemDiv);
    });
}


    // Call the fetchSessionAndUpdateCartPreview function when the page loads
    window.onload = fetchSessionAndUpdateCartPreview;
</script>
<!-- End of JavaScript -->
</body>
</html>
